@using Microsoft.AspNet.Identity
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
            font-size: 14px;
        }

        #top {
            background: #eee;
            border-bottom: 1px solid #ddd;
            padding: 0 10px;
            line-height: 40px;
            font-size: 12px;
        }

        #calendar {
            max-width: 900px;
            margin: 40px auto;
            padding: 50px 10px 0 0;
        }
        
    </style>

    <div id='calendar'></div>
@Html.Partial("_detailEvent")
@Html.Partial("_createEvent")
<script>
    var currentUsername = '@(User.Identity.GetUserName())';
    //var eventApp = angular.module('event', []);
    //$(document).ready(function () {
        var event_ende;
        var event_start;
        today = new Date();
        var year = today.getFullYear();
        var month = today.getMonth() + 1;
        var day = today.getDate();
        //Weil die JQuery Funktion die 0 im Datum weglässt
        if (day < 10) {
            day = '0' + day;
        }
        if (month < 10) {
            month = '0' + month;
        }
        var fullDate = year + "-" + month + "-" + day;
        console.log(fullDate.toString());
		var initialLocaleCode = 'de';

		$('#calendar').fullCalendar({
			header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay,listMonth'
			},
			defaultDate: fullDate.toString(),
			locale: initialLocaleCode,
			buttonIcons: false, // show the prev/next text
			weekNumbers: true,
			weekNumbersWithinDays: true,
			weekNumberCalculation: 'ISO',
			navLinks: true, // can click day/week names to navigate views
			selectable: true,
			selectHelper: false,
            //Create new
			select: function (start, end) {
			    $("#createEvent").css("display", "block");
                //Set global variables to use the times in form save
			    event_start = start;
			    event_ende = end;
			},
            //Detail View
			eventClick: function (calEvent, jsEvent, view) {
			    $("#typ").text(calEvent.typ);
			    $("#name").text(calEvent.title);
			    $("#von").text(calEvent.von);
			    $("#bis").text(calEvent.bis);
			    if (!(typeof calEvent.title === "undefined")) {
			        $("#detail_raidImg").html("<img src='/img/orte/" + calEvent.title.toLowerCase() + ".png' alt='Kein Bild'/>");
			    }
			    $("#character").html("");
			    if (!(typeof calEvent.character === "undefined")) {
			        $.each(calEvent.character, function (char, value) {
                        //Fügt die Charaktere der View hinzu, je nachdem wieviele im Event gespeichert wurden
			            $("#character").append("<li><img src='/img/klassen/" + char + ".png'/>" + char + " : <span title='Maximal'>" + value.count + "</span><span id='" + char + "Count' title='[n] von maximal [n] plätzen belegt'>(" + value.people_in + "/" + value.count + ")</span> <input type='radio' name='anmelden' value='" + char + "'/><span id='" + char + "Teilnehmer'>Teilnehmer: [" + value.teilnehmer + "]</span></li>");

			        });
			        $("#btn_anmelden").css("display", "");
			        $("#btn_anmelden").click(function () {
                        //Sieht nach welcher Character geupdatet werden soll anhand der radio
			            var radioValue = $('input[name=anmelden]:checked', '#detailEvent').val();
			            //Es dürfen sich nicht mehr als die maximale Anzahl anmelden
			            if ((calEvent.character[radioValue].people_in + 1) <= (calEvent.character[radioValue].count)) {
			                //Added die Einladung zu dem Objekt
			                calEvent.character[radioValue].people_in = calEvent.character[radioValue].people_in + 1;
			                //calEvent.character[radioValue].teilnehmer = calEvent.character[radioValue].teilnehmer + currentUserName
			                //Updatet die Zahl auf der Oberfläche //// vllt kann man hier angular verwenden ????
			                $("#" + radioValue + "Count").text("(" + calEvent.character[radioValue].people_in + "/" + calEvent.character[radioValue].count + ")");
                            //Fügt den Username des aktuellen Users der GUI hinzu
			                $("#" + radioValue + "Teilnehmer").text("[Teilnehmer:"+currentUsername + "]");
			                //Updatet das Event im calender
			                $('#calendar').fullCalendar('updateEvent', calEvent);
			            }
			            else {
			                alert("Es können nur max." + calEvent.character[radioValue].count + "x " + radioValue + " teilnehmen");
			            }
			        });
			    }
			    $("#detailEvent").css("display", "block");

			    //console.log('Event: ' + calEvent.title);
			    //console.log('Coordinates: ' + jsEvent.pageX + ',' + jsEvent.pageY);
			    //console.log('View: ' + view.name);


			},
			eventRender: function (event, element) {
			    console.log("eventReder");
			    //element.qtip({
			    //    content: event.description
			    //});
			},
			editable: true,
			eventLimit: true, // allow "more" link when too many events
			events: [
                {
                    type: 'raid',
                    title: 'geistertal',
                    start: '2017-04-07',
                    end: '2017-04-10',
                    von: '17:30',
                    bis: '18:30',
                    character: {
                        "chrono": {
                            count:3,
                            people_in:1,
                            teilnehmer: 'Killingspree.1370'
                        }
                    }
                }
			]
		});

		// build the locale selector's options
		$.each($.fullCalendar.locales, function(localeCode) {
			$('#locale-selector').append(
				$('<option/>')
					.attr('value', localeCode)
					.prop('selected', localeCode == initialLocaleCode)
					.text(localeCode)
			);
		});

		// when the selected option changes, dynamically change the calendar option
		$('#locale-selector').on('change', function() {
			if (this.value) {
				$('#calendar').fullCalendar('option', 'locale', this.value);
			}
		});
	//});

</script>